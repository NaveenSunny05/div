<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Circular Patch Antenna Notes (GNSS)</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    /* ===================== LESSON PAGE ===================== */
    body{
      background:linear-gradient(135deg,#0f3460 0%,#1e3c72 100%);
      color:#fff;min-height:100vh;overflow-x:hidden;
      font-family:'Roboto',sans-serif;
    }

    .lesson-container{
      max-width:980px;margin:0 auto;
      padding:44px 18px 90px;
      position:relative;z-index:2;
    }

    .lesson-header{text-align:center;margin-bottom:28px}
    .lesson-header h1{
      font-size:2.35rem;color:#00d4ff;
      margin-bottom:10px;letter-spacing:.2px
    }
    .lesson-header p{opacity:.92;font-size:1.1rem}

    .antenna-diagram{
      width:305px;height:305px;margin:24px auto 16px;
      background:conic-gradient(from 0deg,#ffd700,#ff8c00,#ff4500,#ffd700);
      border-radius:50%;position:relative;
      animation:rotate 12s linear infinite;
      box-shadow:0 0 55px rgba(255,215,0,.55);
    }
    @keyframes rotate{to{transform:rotate(360deg)}}

    .patch{
      position:absolute;inset:17%;
      border-radius:50%;
      background:radial-gradient(circle,#ff4500 0%,#c93400 100%);
      box-shadow:inset 0 0 40px rgba(255,255,255,.22);
    }
    .feed-line{
      position:absolute;bottom:-28px;left:50%;
      transform:translateX(-50%);
      width:22px;height:85px;border-radius:12px;
      background:linear-gradient(to top,#ffd700,#fff2a6);
      box-shadow:0 0 18px rgba(255,215,0,.65);
    }

    .grid{
      display:grid;grid-template-columns:1fr 1fr;
      gap:18px;margin-top:24px
    }
    .card{
      background:rgba(6,20,40,.42);
      border:1px solid rgba(160,220,255,.18);
      border-radius:18px;padding:18px;
      backdrop-filter:blur(10px);
    }
    .card h3{color:#00d4ff;font-size:1.2rem;margin-bottom:10px}

    .formula{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      background:rgba(0,212,255,.12);
      border:1px solid rgba(0,212,255,.18);
      padding:12px;border-radius:12px;
      margin:10px 0;line-height:1.45;font-size:.98rem;
    }

    .lesson-buttons{
      display:flex;flex-wrap:wrap;
      gap:14px;justify-content:center;
      margin-top:22px;
    }
    .lesson-btn{
      padding:15px 22px;min-width:240px;
      border:none;border-radius:999px;
      background:linear-gradient(45deg,#00d4ff,#0099cc);
      color:#fff;cursor:pointer;
      font-size:1.05rem;font-weight:700;
      transition:transform .25s ease, box-shadow .25s ease;
      box-shadow:0 10px 26px rgba(0,212,255,.28);
    }
    .lesson-btn:hover{transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,212,255,.38)}

    .tiny-note{margin-top:14px;text-align:center;opacity:.75;font-size:.95rem}

    /* ===================== TRANSITION (HEARTS ONLY HERE) ===================== */
    #transition{
      position:fixed;inset:0;z-index:1000;
      background:radial-gradient(circle at 30% 20%,
        rgba(255,182,193,.92),
        rgba(255,20,147,.92),
        rgba(120,20,90,.96)
      );
      opacity:0;visibility:hidden;
      transition:opacity .55s ease, visibility .55s ease;
      overflow:hidden;
    }
    #transition.active{opacity:1;visibility:visible}

    #transition .soft-glow{
      position:absolute;inset:-20%;
      background:radial-gradient(circle at 50% 50%, rgba(255,255,255,.18), transparent 60%);
      filter:blur(14px);
      animation:glowPulse 1.4s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes glowPulse{
      0%,100%{transform:scale(1);opacity:.55}
      50%{transform:scale(1.08);opacity:.9}
    }

    #hearts-layer{position:absolute;inset:0;pointer-events:none}
    .t-heart{
      position:absolute;bottom:-60px;
      font-size:22px;opacity:.95;
      filter:drop-shadow(0 6px 12px rgba(0,0,0,.18));
      animation:floatHearts var(--dur) linear forwards;
    }
    @keyframes floatHearts{
      0%{transform:translateY(0) translateX(0) scale(var(--s));opacity:0}
      10%{opacity:1}
      100%{
        transform:translateY(calc(-100vh - 120px)) translateX(var(--x)) rotate(var(--r))
          scale(calc(var(--s) + .35));
        opacity:0
      }
    }

    .transition-text{
      position:absolute;inset:0;
      display:grid;place-items:center;
      text-align:center;padding:24px;
      pointer-events:none;
    }
    .transition-text .line1{
      font-family:'Dancing Script',cursive;
      font-size:3.1rem;color:rgba(255,255,255,.98);
      text-shadow:0 12px 30px rgba(0,0,0,.25);
      animation:textIn .8s ease-out forwards;
      opacity:0;transform:translateY(18px);
    }
    .transition-text .line2{
      margin-top:10px;font-family:'Poppins',sans-serif;
      font-size:1.05rem;color:rgba(255,255,255,.9);
      opacity:0;transform:translateY(10px);
      animation:textIn .8s ease-out .25s forwards;
    }
    @keyframes textIn{to{opacity:1;transform:translateY(0)}}

    /* ===================== PROPOSAL PAGE ===================== */
    #proposal-page{
      position:fixed;inset:0;z-index:900;
      display:none;overflow-y:auto;
      background:linear-gradient(135deg,#ff9a9e 0%,#fecfef 50%,#fad0c4 100%);
      font-family:'Poppins',sans-serif;
      color:#4b1230;
    }

    #proposal-page::before{
      content:"";position:fixed;inset:0;z-index:0;pointer-events:none;
      background-image:
        radial-gradient(circle at 20% 80%, rgba(255, 20, 147, 0.16) 2px, transparent 2px),
        radial-gradient(circle at 80% 20%, rgba(214, 51, 132, 0.14) 1px, transparent 1px),
        radial-gradient(circle at 40% 40%, rgba(255, 105, 180, 0.12) 1.5px, transparent 1.5px);
      background-size:52px 52px, 86px 86px, 110px 110px;
    }

    .proposal-container{
      max-width:820px;margin:0 auto;
      padding:60px 18px 90px;
      position:relative;z-index:1;
      animation:fadeUp .9s ease-out;
    }
    @keyframes fadeUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}

    .proposal-title{
      font-family:'Dancing Script',cursive;
      font-size:3.4rem;color:#b31259;
      text-shadow:0 10px 22px rgba(0,0,0,.12);
      margin-bottom:6px;text-align:center;
      animation:heartbeat 1.9s ease-in-out infinite;
    }
    @keyframes heartbeat{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

    .proposal-sub{
      text-align:center;
      color:rgba(75,18,48,.86);
      font-size:1.05rem;margin-bottom:14px;
    }

    .ring{
      text-align:center;font-size:4.4rem;
      margin:10px 0 18px;
      filter:drop-shadow(0 14px 24px rgba(0,0,0,.12));
      animation:sparkle 2.2s ease-in-out infinite;
    }
    @keyframes sparkle{0%,100%{transform:rotate(0) scale(1)}50%{transform:rotate(10deg) scale(1.07)}}

    .poem-panel{
      background:linear-gradient(180deg, rgba(255,105,180,.14), rgba(255,255,255,.06));
      border:1px solid rgba(179,18,89,.20);
      border-radius:22px;
      padding:18px 16px;
      backdrop-filter:blur(12px);
      box-shadow:0 18px 60px rgba(179,18,89,.10);
    }
    .poem{
      font-family:'Dancing Script',cursive;
      font-size:1.95rem;
      line-height:1.35;
      text-align:center;
      color:#4b1230;
    }
    .poem .small{
      font-family:'Poppins',sans-serif;
      font-size:1.03rem;
      line-height:1.75;
      color:rgba(75,18,48,.86);
      margin-top:10px;
    }
    .highlight{color:#d10a6a;font-weight:800}

    .proposal-buttons{
      display:flex;flex-direction:column;
      gap:14px;margin-top:18px;
    }
    .pbtn{
      border:none;border-radius:999px;
      padding:18px 20px;
      font-size:1.2rem;font-weight:800;
      cursor:pointer;min-height:66px;
      transition:transform .22s ease, box-shadow .22s ease;
    }
    .pbtn.yes{
      background:linear-gradient(45deg,#ff69b4,#ff1493);
      color:#fff;
      box-shadow:0 18px 45px rgba(255,20,147,.28);
    }
    .pbtn.no{
      background:rgba(255,255,255,.22);
      color:#b31259;
      border:3px solid rgba(179,18,89,.40);
      backdrop-filter:blur(12px);
      box-shadow:0 18px 45px rgba(179,18,89,.14);
    }
    .pbtn:hover{transform:scale(1.03)}

    .response{
      margin-top:18px;min-height:72px;
      font-size:2.0rem;
      font-family:'Dancing Script',cursive;
      opacity:0;transition:opacity .4s ease;
      text-align:center;color:#4b1230;
    }
    .accepted{
      color:#0a9d5a !important;
      animation:bounce 1.1s infinite;
    }
    @keyframes bounce{
      0%,20%,50%,80%,100%{transform:translateY(0)}
      40%{transform:translateY(-10px)}
      60%{transform:translateY(-6px)}
    }

    @media (max-width:860px){.grid{grid-template-columns:1fr}}
    @media (max-width:520px){
      .lesson-header h1{font-size:2.0rem}
      .antenna-diagram{width:265px;height:265px}
      .proposal-title{font-size:3.0rem}
      .poem{font-size:1.75rem}
    }
  </style>
</head>

<body>
  <audio id="bgm" src="sayyara.mp3" preload="auto" loop></audio>

  <div class="lesson-container" id="lesson">
    <div class="lesson-header">
      <h1>Circular Patch Antenna Design</h1>
      <p>GNSS L1 notes ‚Ä¢ CST workflow ‚Ä¢ Quick calculator</p>
    </div>

    <div class="antenna-diagram">
      <div class="patch"></div>
      <div class="feed-line"></div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Design start</h3>
        <div class="formula">
          Target: f = 1.575 GHz (GNSS L1)<br>
          Substrate: Œµr ‚âà 2.2, h ‚âà 1.6 mm
        </div>
        <div class="formula">
          Initial radius: a ‚âà c / (2 f ‚àöŒµr)
        </div>
        <p style="opacity:0.9; line-height:1.6;">
          Tune: S11, axial ratio, RHCP/LHCP, gain.
        </p>
      </div>

      <div class="card">
        <h3>CST flow</h3>
        <p style="opacity:0.92; line-height:1.75;">
          Substrate ‚Üí Ground ‚Üí Patch ‚Üí Feed/Port ‚Üí Sweep ‚Üí S11/AR ‚Üí Pattern ‚Üí Optimize
        </p>
        <div class="formula">
          CP check: axial ratio and phase quadrature in radiated fields.
        </div>
      </div>
    </div>

    <div class="lesson-buttons">
      <button class="lesson-btn" onclick="startTransition('LESSON_CALC')">Calculate Patch Radius</button>
      <button class="lesson-btn" onclick="startTransition('LESSON_SETUP')">CST Setup Guide</button>
      <button class="lesson-btn" onclick="startTransition('LESSON_RESULTS')">View S11 / Axial Ratio</button>
    </div>

    <div class="tiny-note">Internal reference ‚Ä¢ mobile friendly</div>
  </div>

  <div id="transition">
    <div class="soft-glow"></div>
    <div id="hearts-layer"></div>
    <div class="transition-text">
      <div>
        <div class="line1">A little heart‚Äëto‚Äëheart‚Ä¶</div>
        <div class="line2">Just for you</div>
      </div>
    </div>
  </div>

  <section id="proposal-page" aria-hidden="true">
    <div class="proposal-container">
      <div class="proposal-title">My Dear Divya</div>
      <div class="proposal-sub">Read this slowly‚Ä¶</div>
      <div class="ring" id="ring">üíç</div>

      <div class="poem-panel">
        <div class="poem">
          I loved research‚Äîchasing truth in waves and light,<br>
          But more than that, I love you‚Ä¶ more than words can write.<br><br>

          In labs I learned resonance, how a heart can truly stay,<br>
          Tuned to one frequency‚Ä¶ and never drift away.<br><br>

          I used to dream of NRSC, of work that reaches sky,<br>
          Now my dream is simpler‚Äî<span class="highlight">to live with you</span> till time goes by.<br><br>

          Like antennas finding signals through noise and through the rain,<br>
          You found my quiet heart, and made it beat again.<br><br>

          If life is redesigns‚Äîtest, fail, and try anew,<br>
          Be my forever partner‚Ä¶ my constant, always true.<br><br>

          <span class="highlight">Divya, will you marry me?</span>

          <div class="small">
            I love research‚Ä¶ but more than that, I love you.
          </div>
        </div>
      </div>

      <div class="proposal-buttons">
        <button class="pbtn yes" onclick="handleChoice('YES')">Yes</button>
        <button class="pbtn no" onclick="handleChoice('NEED_TIME')">Give me a minute‚Ä¶</button>
      </div>

      <div class="response" id="resp"></div>
    </div>
  </section>

  <script>
    const GOOGLE_SCRIPT_WEBAPP_URL =
      "https://script.google.com/macros/s/AKfycbwrtKubT2WQrlnAQD30ee1CK6ygW81b-BDBdkBe0UbyD72kNpvoNpWbiMkMC2o2mXuv/exec";

    let heartTimer = null;

    function spawnTransitionHeart(){
      const layer = document.getElementById('hearts-layer');
      const el = document.createElement('div');
      el.className = 't-heart';
      el.textContent = ['üíñ','üíï','üíó','üíù','üíò'][Math.floor(Math.random()*2)];

      const left = Math.random()*100;
      const dur  = 2.6 + Math.random()*1.8;
      const x    = (Math.random()*140 - 70) + 'px';
      const r    = (Math.random()*220 - 110) + 'deg';
      const s    = (0.75 + Math.random()*0.85);

      el.style.left = left + 'vw';
      el.style.setProperty('--dur', dur + 's');
      el.style.setProperty('--x', x);
      el.style.setProperty('--r', r);
      el.style.setProperty('--s', s);

      layer.appendChild(el);
      setTimeout(() => el.remove(), (dur*1000) + 200);
    }

    function startHeartsBurst(){
      const layer = document.getElementById('hearts-layer');
      layer.innerHTML = '';
      for (let i=0;i<28;i++) setTimeout(spawnTransitionHeart, i*55);
      heartTimer = setInterval(() => { for (let i=0;i<3;i++) spawnTransitionHeart(); }, 220);
    }

    function stopHeartsBurst(){
      if (heartTimer) clearInterval(heartTimer);
      heartTimer = null;
      setTimeout(() => { document.getElementById('hearts-layer').innerHTML = ''; }, 800);
    }

    function logEvent(eventName){
      const payload = {
        event: eventName,
        ts: Date.now(),
        ua: navigator.userAgent
      };

      // Beacon API queues a small POST payload without blocking the UI. [web:177]
      try{
        const blob = new Blob([JSON.stringify(payload)], { type: "text/plain" });
        const ok = navigator.sendBeacon(GOOGLE_SCRIPT_WEBAPP_URL, blob);
        if (ok) return;
      }catch(e){}

      // Fallback (fire-and-forget)
      fetch(GOOGLE_SCRIPT_WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      }).catch(() => {});
    }

    function startTransition(whichLessonButton){
      logEvent(whichLessonButton);

      // Start music after user gesture (button click)
      const bgm = document.getElementById('bgm');
      bgm.volume = 0.35;
      bgm.play().catch(() => {});

      const overlay = document.getElementById('transition');
      overlay.classList.add('active');
      startHeartsBurst();

      setTimeout(() => {
        stopHeartsBurst();
        overlay.classList.remove('active');
        document.getElementById('lesson').style.display = 'none';
        document.getElementById('proposal-page').style.display = 'block';
        document.title = "For Divya";
      }, 2800);
    }

    function acceptProposal(){
      const resp = document.getElementById('resp');
      resp.innerHTML = "Yes‚Ä¶<br>That‚Äôs all my heart ever wanted.";
      resp.classList.add('accepted');
      resp.style.opacity = '1';
      document.getElementById('ring').innerHTML = 'üíç‚ú®üíñ';
    }

    function needTimeMessage(){
      const resp = document.getElementById('resp');
      resp.innerHTML =
        "Take your time, Divya‚Ä¶<br>" +
        "No pressure, no hurry‚Äîjust honesty.<br>" +
        "Thank you for reading this.";
      resp.style.opacity = '1';
    }

    function handleChoice(choice){
      logEvent("PROPOSAL_" + choice);
      if (choice === "YES") acceptProposal();
      else needTimeMessage();
    }
  </script>
</body>
</html>
